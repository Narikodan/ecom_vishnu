<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My eCommerce Website</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Custom CSS -->
  <style>
    #banner img {
      height: 90px;
      width: 100%;
    }

    #companylogo img {
      border-radius: 50%;
    }

    .custom-button {
      display: block;
      width: 100%;
      margin-bottom: 10px;
    }

    .add-to-cart {
      background-color: #007bff;
      border-color: #007bff;
    }

    .add-to-cart:hover {
      background-color: #0069d9;
      border-color: #0062cc;
    }

    .buy-now {
      background-color: #28a745;
      border-color: #28a745;
    }

    .buy-now:hover {
      background-color: #218838;
      border-color: #1e7e34;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  {% include 'myapp/navbar.html' %}


  {% for message in success_message %}
  <div class="alert alert-success">
    {{ message }}
  </div>
  {% endfor %}

  <!-- Products Section -->
  <div class="container mt-4">
    <h2>Products</h2>
    <div class="row card-deck">
      {% for product in products %}
      <div class="col-md-3">
        <div class="card h-100">
          <div id="carousel-products-{{ product.id }}" class="carousel slide" data-ride="carousel">
            <a href="/{{product.id}}">
              <div class="carousel-inner">
                <div class="carousel-item active">
                  <img src="{{ product.image_url_1 }}" class="card-img-top" alt="Product Image 1"
                    style="max-height: 200px; object-fit: contain;">
                </div>
                <div class="carousel-item">
                  <img src="{{ product.image_url_2 }}" class="card-img-top" alt="Product Image 2"
                    style="max-height: 200px; object-fit: contain;">
                </div>
                <div class="carousel-item">
                  <img src="{{ product.image_url_3 }}" class="card-img-top" alt="Product Image 3"
                    style="max-height: 200px; object-fit: contain;">
                </div>
              </div>
            </a>
            <!-- Add carousel controls if needed -->
          </div>
          <div class="card-body">
            <h5 class="card-title" style="font-style: italic;">{{ product.name }}</h5>
          </div>
          <div class="card-footer border-0 bg-transparent">
            <p class="card-text mb-0">
              <span style="font-weight: bold; font-style: italic; font-size: 25px; color:rgb(39, 37, 37)">â‚¹{{ product.price }}</span>
            </p>
          </div>
          <div class="card-footer">
            {% if user.is_authenticated %}
            <button class="btn btn-primary custom-button add-to-cart" data-product-id="{{ product.id }}">Add to Cart</button>
            {% else %}
            <a href="{% url 'myapp:login' %}" class="btn btn-primary custom-button">Add to Cart</a>
            {% endif %}
            <form action="{% url 'myapp:buynow' product.id %}" method="POST">
              {% csrf_token %}
              <button type="submit" class="btn btn-success custom-button buy-now">Buy Now</button>
            </form>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var addToCartButtons = document.querySelectorAll('.add-to-cart');
      addToCartButtons.forEach(function (button) {
        button.addEventListener('click', function () {
          {% if user.is_authenticated %}
          var productId = button.getAttribute('data-product-id');
          var xhr = new XMLHttpRequest();
          xhr.open('POST', '/cart');
          xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
          var csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
          var data = 'product_id=' + encodeURIComponent(productId) + '&csrfmiddlewaretoken=' + encodeURIComponent(csrftoken);
          xhr.onload = function () {
            if (xhr.status === 200) {
              var response = JSON.parse(xhr.responseText);
              if (response.status === 'success') {
                button.textContent = 'Added to Cart';
                button.setAttribute('disabled', 'disabled');
              }
            } else {
              alert('An error occurred. Please try again.');
            }
          };
          xhr.onerror = function () {
            alert('An error occurred. Please try again.');
          };
          xhr.send(data);
          {% endif %}
        });
      });
    });
  </script>

</body>

</html>
